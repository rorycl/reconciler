{{- /* partial-donations-searchresults.html is a template for the donation search results */ -}}

{{ define "partial-donations-searchresults" }}
{{ $pageType := .PageType }}
<!-- start of partial -->

<div id="donations-link-error" class="text-red-500"></div>

{{- /* the link form targets: Typer: invoice or bank-transaction .ID: the invoice number or bank-transaction reference */ -}}
<form hx-post="/donations/{{ .Typer }}/{{ .ID }}/link"
      hx-target="#donations-link-error"
      hx-swap="innerHTML">
<div class="border-2 border-slate-300 mx-4 mb-3"> 
    <table class="min-w-full divide-y divide-slate-300 text-xs">
        <thead class="bg-slate-100 text-slate-700">
            <tr>
                {{ if eq $pageType "indirect" }}
                <th class="px-4 py-0 w-8">
                <button class="text-xs bg-sky-600 text-white font-bold py-1 px-1 mr-2 rounded hover:bg-sky-700">Link</button>
                {{ end }}
                </th>
                <th class="min-w-3/10 px-4 py-2 text-left font-semibold">Name</th>
                <th class="px-4 py-2 text-left font-semibold">Close Date</th>
                <th class="min-w-3/10 px-4 py-2 text-left font-semibold">Payout Reference</th>
                <th class="px-4 py-2 text-right font-semibold">Amount</th>
                <th class="px-4 py-2 text-center font-semibold">Linked</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-slate-300">
            {{ range .ViewDonations }}
            <tr class="hover:bg-slate-50">
                {{ if eq $pageType "indirect" }}
                <td class="px-4 py-1 text-center"><input name="donation-ids" value="{{ .ID }}" type="checkbox"></td>
                {{ end }}
                <td class="px-4 py-1"><a href="/donation/{{ .ID }}" class="text-sky-700 font-semibold hover:underline">{{ .Name }}</a></td>
                <td class="px-4 py-1 whitespace-nowrap">{{ .CloseDateStr }}</td>
                <td class="px-4 py-1">{{ .PayoutReference }}</td>
                <td class="px-4 py-1 text-right font-mono">{{ printf "%.2f" .Amount }}</td>
                <td class="px-4 py-1 text-center">
                    {{ if .IsLinked }}
                    <span class="inline-flex items-center rounded-full bg-green-100 px-4 py-1 text-xs font-medium text-green-700">OK</span>
                    {{ else }}
                    <span class="inline-flex items-center rounded-full bg-red-100 px-4 py-1 text-xs font-medium text-red-700">!</span>
                    {{ end }}
                </td>
            </tr>
            {{ else }}
            <tr>
                <td colspan="5" class="px-4 py-3">There are no records to display.</td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</div>
</form>
<!-- end of partial -->

<!-- Pagination -->
<div class="mt-4 pb-2 mb-2 text-center text-xs text-slate-800">
    {{ $URL := .Pagination.PreviousURL }}
    {{ if $URL }}
        <a href="{{ $URL }}" 
           class="px-3 py-1 border border-indigo-300 rounded hover:bg-indigo-100">&laquo; Prev</a>
    {{ else }}
        <span class="text-slate-400 cursor-not-allowed">&laquo; Prev</span>
    {{ end }}

    <span class="mx-4">
    page {{ .Pagination.PageNo }} of {{ .Pagination.Pages }}
    </span>

    {{ $URL := .Pagination.NextURL }}
    {{ if $URL }}
        <a href="{{ $URL }}"
           class="px-3 py-1 border border-indigo-300 rounded hover:bg-indigo-100">Next &raquo;</a>
    {{ else }}
        <span class="text-slate-400 cursor-not-allowed">Next &raquo;</span>
    {{ end }}
</div>
{{ end }}
